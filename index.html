<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Tkooops</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="归来仍少年">
<meta property="og:type" content="website">
<meta property="og:title" content="Tkooops">
<meta property="og:url" content="http://kkrisen.top/index.html">
<meta property="og:site_name" content="Tkooops">
<meta property="og:description" content="归来仍少年">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Tkooops">
<meta name="twitter:description" content="归来仍少年">
  
    <link rel="alternate" href="/atom.xml" title="Tkooops" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Tkooops</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">teakeeper</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Rechercher"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://kkrisen.top"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-iOS-webview-网络请求代理调研" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/20171009/iOS-webview-网络请求代理调研.html/" class="article-date">
  <time datetime="2017-10-09T02:54:44.000Z" itemprop="datePublished">2017-10-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/20171009/iOS-webview-网络请求代理调研.html/">iOS webview 网络请求代理调研</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>在iOS中，除了普通请求（NSURLSession、NSURLConnection）以外，还有一种webview的请求，这是iOS的一种UI组件，可直接调用其loadRequest方法，发起请求，webview会把response以html的形式加载到其界面上。</p>
<p>我们主要对于常用的UIWebview、WKWebview的网络请求尝试使用Cronet进行代理进行了调研分析。<br></p>
        
          <p class="article-more-link">
            <a href="/20171009/iOS-webview-网络请求代理调研.html/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://kkrisen.top/20171009/iOS-webview-网络请求代理调研.html/" data-id="cj8jls2je0004b79kyg3znfbu" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-iOS版本导致NSURLSession表现不一致问题调研" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/20171009/iOS版本导致NSURLSession表现不一致问题调研.html/" class="article-date">
  <time datetime="2017-10-09T02:18:45.000Z" itemprop="datePublished">2017-10-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/20171009/iOS版本导致NSURLSession表现不一致问题调研.html/">iOS版本导致NSURLSession表现不一致问题调研</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>iOS8.1系统上，使用Cronet测试网络请求，请求未能使用经过Cronet发送，仍使用iOS自身系统网络库。在iOS 9及以上系统未出现这个问题。</p>
        
          <p class="article-more-link">
            <a href="/20171009/iOS版本导致NSURLSession表现不一致问题调研.html/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://kkrisen.top/20171009/iOS版本导致NSURLSession表现不一致问题调研.html/" data-id="cj8jls2jj0005b79kd08gl70t" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-使用mqtt协议实现iOS端心跳探活" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/20171009/使用mqtt协议实现iOS端心跳探活.html/" class="article-date">
  <time datetime="2017-10-09T01:46:47.000Z" itemprop="datePublished">2017-10-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/20171009/使用mqtt协议实现iOS端心跳探活.html/">使用mqtt协议实现iOS端心跳探活</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>这是AI稳定性建设项目的一个子项，目的是实现对iOS端设备的生命健康检查，技术方案是使用mqtt协议建立并维持iOS端设备与服务器的心跳，服务端对心跳数据建立监测机制。</p>
<p>我参与的主要是iOS端代码的开发，因此该文档主要为在iOS端使用mqtt协议发送心跳的调研和实践。</p>
<h3 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h3><p>移动端监测与服务器监测最大的不同，应该在于移动端设备所处的网络环境是复杂多变的，而我们的心跳探活目的是确认端设备本身是否正常。</p>
<p>因此在选择端设备与服务端的通信协议时，要求对网络依赖小且在比如弱网环境下依然稳定工作，这样才能避免网络环境不稳定造成的干扰，避免一些误判。</p>
<p>Mqtt (Message Queue Telemetry Transport)协议是一种应用层协议，适用于资源受限例如低带宽、高延迟网络环境下的端到端通信。这种适用性主要是来自于它在包大小的精简以及对push消息场景的一些优化。</p>
<p>因此最终选用的mqtt协议作为心跳探活的通信协议，mqtt的对比介绍还可参见：<a href="https://blogs.vmware.com/vfabric/2013/02/choosing-your-messaging-protocol-amqp-mqtt-or-stomp.html" target="_blank" rel="external">Choosing Your Messaging Protocol: AMQP, MQTT, or STOMP</a></p>
        
          <p class="article-more-link">
            <a href="/20171009/使用mqtt协议实现iOS端心跳探活.html/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://kkrisen.top/20171009/使用mqtt协议实现iOS端心跳探活.html/" data-id="cj8jls2jv000cb79kz6k6xyg1" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-项目版本号自动化实践" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/20171009/项目版本号自动化实践.html/" class="article-date">
  <time datetime="2017-10-09T00:49:44.000Z" itemprop="datePublished">2017-10-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/20171009/项目版本号自动化实践.html/">项目版本号自动化实践</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>项目组基于Cronet自研的产品每次对外发布对应一个版本号，在此之前版本号都是手动由Release Engineer进行填写，并在代码中用到了版本号的地方进行相应修改。</p>
<p><strong>现状</strong><br>版本号分为4位，前两位对应一次发布，第三位为patch（从1开始），第四位没有作用，默认为1。例如1.5.2.1，即表示我们2016.12月份发布的1.5版本，其中进行了一次patch,因此第三位为2。</p>
<p>版本号由Release Engineer在组内确认完后，由于目前部分模块均在代码中写死了版本号，需要去手动调整后再commit一次，才能发布。</p>
<p>总之，这块存在两个问题。</p>
<ol>
<li>我们对四位版本号的使用不合理，实际上只用到了其中三位。</li>
<li>每次发布时，为了版本号需要人工去调整代码，这显然是很难忍受的。</li>
</ol>
<p><strong>目标</strong><br>为了提高效率，我们将现状和需求分析了下，分为两个具体要做的事:</p>
<ul>
<li>提供统一的版本号配置管理，只需修改版本号配置，便可应用到整个代码库。</li>
<li>尽量将版本号做成自动化无需人工干预的。</li></ul>
        
          <p class="article-more-link">
            <a href="/20171009/项目版本号自动化实践.html/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://kkrisen.top/20171009/项目版本号自动化实践.html/" data-id="cj8jls2ju000bb79kewdbrwpv" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Cronet静态库编译解决方案" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/20171008/Cronet静态库编译解决方案.html/" class="article-date">
  <time datetime="2017-10-08T15:02:36.000Z" itemprop="datePublished">2017-10-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/20171008/Cronet静态库编译解决方案.html/">Cronet静态库编译解决方案</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>由于公司产品需求，需要在iOS编译发布中支持静态库包，而我们默认的编译发布是动态库，chromium官方也是只支持动态库。</p>
<p>这个目标实际就是能使用ninja命令配合一定的编译参数就可以编译出静态库+在发布时能将静态产物抛给Agile。这里面预计设计两方面的改动：第一个就是我们的库代码，第二个是编译server。</p>
        
          <p class="article-more-link">
            <a href="/20171008/Cronet静态库编译解决方案.html/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://kkrisen.top/20171008/Cronet静态库编译解决方案.html/" data-id="cj8jls2jk0006b79k04f2g22k" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Cronet双端持续集成发布实践" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/20171008/Cronet双端持续集成发布实践.html/" class="article-date">
  <time datetime="2017-10-08T08:56:15.000Z" itemprop="datePublished">2017-10-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/20171008/Cronet双端持续集成发布实践.html/">Cronet双端持续集成发布实践</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><ul>
<li>Cronet是chromium项目的网络协议栈，其编译产出环境需要Ubuntu系统加Chromium的编译工具。</li>
<li>公司内部无法提供满足需求的编译发布服务，因此只能自建编译产出系统。</li>
<li>团队已有的编译系统只能发布Cronet Android，随着iOS版开始接入产品，我们需要支持Cronet iOS的编译发布。</li></ul>
        
          <p class="article-more-link">
            <a href="/20171008/Cronet双端持续集成发布实践.html/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://kkrisen.top/20171008/Cronet双端持续集成发布实践.html/" data-id="cj8jls2jc0003b79klnbgb1sn" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-使用python-unidiff库分析git-diff" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/20171006/使用python-unidiff库分析git-diff.html/" class="article-date">
  <time datetime="2017-10-06T15:09:53.000Z" itemprop="datePublished">2017-10-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/20171006/使用python-unidiff库分析git-diff.html/">使用python unidiff库分析git diff</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>这里分享一个python写的分离特定的git修改的方法。<br>主要应用的问题是当时项目组需要同步chromium最新代码，结果带来了巨大量的改动，为了节省我们review新代码的时间，需要将一些不重要的修改（携带某种特征，例如新版本的chromium大量替换了智能指针，将自研的scoped_ptr变成了std::unique_ptr）分离出来，剩下的就是重要的修改了。</p>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><p>这里主要用到python的unidiff库，这个库可以解析出标准的unified diff data，git diff恰好就是这个格式。<br></p>
        
          <p class="article-more-link">
            <a href="/20171006/使用python-unidiff库分析git-diff.html/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://kkrisen.top/20171006/使用python-unidiff库分析git-diff.html/" data-id="cj8jls2jx000db79k5b4d9125" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-在chromium项目中支持gcov单测覆盖率" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/20171006/在chromium项目中支持gcov单测覆盖率.html/" class="article-date">
  <time datetime="2017-10-06T12:19:59.000Z" itemprop="datePublished">2017-10-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/20171006/在chromium项目中支持gcov单测覆盖率.html/">在chromium项目中支持gcov单测覆盖率</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="简单介绍一下gcov和lcov"><a href="#简单介绍一下gcov和lcov" class="headerlink" title="简单介绍一下gcov和lcov"></a>简单介绍一下gcov和lcov</h4><p>gcov是gcc中的一个附带工具，配合GCC编译进行覆盖测试使用<br>在gcc编译时，使用-fprofile-arcs  -ftest-coverage两个编译参数，即可使用gcov的功能<br>在编译成功后，会生成.gcno文件，文件来自于编译过程中对目标文件打的桩生成的。<br>对可执行文件进行一次运行，即可得到.gcda文件<br>最终，用gcov工具对源代码进行处理，得到.gcov文件，即为我们需要的覆盖信息的初试状态</p>
<p>因为gcov生成的是纯文字，不好直观展现，lcov工具就是在gcov的基础上，生成html做了界面化展现。</p>
<p>我们准备在chromium项目(Cronet)中新增gcov单测覆盖率<br>chromium使用的是Google自研的gn &amp; ninja，前者gn是用于生成类似Makefile的编译文件，后者进行真正的编译，产出对象文件<br>关于chromium的编译可以参考官方文档：<a href="https://chromium.googlesource.com/chromium/src/+/master/docs/linux_build_instructions.md" target="_blank" rel="external">https://chromium.googlesource.com/chromium/src/+/master/docs/linux_build_instructions.md</a><br></p>
        
          <p class="article-more-link">
            <a href="/20171006/在chromium项目中支持gcov单测覆盖率.html/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://kkrisen.top/20171006/在chromium项目中支持gcov单测覆盖率.html/" data-id="cj8jls2jq0009b79kpav6srcp" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Cronet-httpCache基本逻辑" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/20171006/Cronet-httpCache基本逻辑.html/" class="article-date">
  <time datetime="2017-10-06T08:53:05.000Z" itemprop="datePublished">2017-10-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/20171006/Cronet-httpCache基本逻辑.html/">Cronet-httpCache基本逻辑</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>对Cronet中如何做http cache做了一个梳理解析.<br>先介绍一下Cronet网络库的启动流程<br><img src="cronet-httpcache.jpg" alt="Cronet-httpcache"><br>以Android举例，如上图，Cronet是一个单线程网络库，在java层存在唯一的CronetEngine，在C++层存在唯一的URLRequestContext，它们是网络库最核心的上下文。<br></p>
        
          <p class="article-more-link">
            <a href="/20171006/Cronet-httpCache基本逻辑.html/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://kkrisen.top/20171006/Cronet-httpCache基本逻辑.html/" data-id="cj8jls2iz0001b79kmvfvnt04" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Cronet-http-header相关逻辑梳理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/20171006/Cronet-http-header相关逻辑梳理.html/" class="article-date">
  <time datetime="2017-10-06T08:26:48.000Z" itemprop="datePublished">2017-10-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/20171006/Cronet-http-header相关逻辑梳理.html/">Cronet http-header相关逻辑梳理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>本章梳理Cronet对于http header的处理逻辑。包含Android &amp; iOS两个平台。<br></p>
        
          <p class="article-more-link">
            <a href="/20171006/Cronet-http-header相关逻辑梳理.html/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://kkrisen.top/20171006/Cronet-http-header相关逻辑梳理.html/" data-id="cj8jls2it0000b79ku6j3e910" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Articles récents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/20171009/iOS-webview-网络请求代理调研.html/">iOS webview 网络请求代理调研</a>
          </li>
        
          <li>
            <a href="/20171009/iOS版本导致NSURLSession表现不一致问题调研.html/">iOS版本导致NSURLSession表现不一致问题调研</a>
          </li>
        
          <li>
            <a href="/20171009/使用mqtt协议实现iOS端心跳探活.html/">使用mqtt协议实现iOS端心跳探活</a>
          </li>
        
          <li>
            <a href="/20171009/项目版本号自动化实践.html/">项目版本号自动化实践</a>
          </li>
        
          <li>
            <a href="/20171008/Cronet静态库编译解决方案.html/">Cronet静态库编译解决方案</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Krisen Tan<br>
      Propulsé by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>