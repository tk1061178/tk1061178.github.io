<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Cronet-httpCache基本逻辑 | Tkooops</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="背景对Cronet中如何做http cache做了一个梳理解析.先介绍一下Cronet网络库的启动流程以Android举例，如上图，Cronet是一个单线程网络库，在java层存在唯一的CronetEngine，在C++层存在唯一的URLRequestContext，它们是网络库最核心的上下文。">
<meta property="og:type" content="article">
<meta property="og:title" content="Cronet-httpCache基本逻辑">
<meta property="og:url" content="http://kkrisen.top/blog/ef0c76f5/index.html">
<meta property="og:site_name" content="Tkooops">
<meta property="og:description" content="背景对Cronet中如何做http cache做了一个梳理解析.先介绍一下Cronet网络库的启动流程以Android举例，如上图，Cronet是一个单线程网络库，在java层存在唯一的CronetEngine，在C++层存在唯一的URLRequestContext，它们是网络库最核心的上下文。">
<meta property="og:image" content="http://kkrisen.top/blog/ef0c76f5/cronet-httpcache.jpg">
<meta property="og:image" content="http://kkrisen.top/blog/ef0c76f5/cronet-rfc.jpg">
<meta property="og:image" content="http://kkrisen.top/blog/ef0c76f5/cronet-chromium-discuss.jpg">
<meta property="og:updated_time" content="2017-12-15T01:52:09.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Cronet-httpCache基本逻辑">
<meta name="twitter:description" content="背景对Cronet中如何做http cache做了一个梳理解析.先介绍一下Cronet网络库的启动流程以Android举例，如上图，Cronet是一个单线程网络库，在java层存在唯一的CronetEngine，在C++层存在唯一的URLRequestContext，它们是网络库最核心的上下文。">
<meta name="twitter:image" content="http://kkrisen.top/blog/ef0c76f5/cronet-httpcache.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Tkooops" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Tkooops</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">techkeeper</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://kkrisen.top"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Cronet-httpCache基本逻辑" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/ef0c76f5/" class="article-date">
  <time datetime="2017-10-06T08:53:05.000Z" itemprop="datePublished">2017-10-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Cronet-httpCache基本逻辑
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3><span id="背景">背景</span></h3><p>对Cronet中如何做http cache做了一个梳理解析.<br>先介绍一下Cronet网络库的启动流程<br><img src="cronet-httpcache.jpg" alt="Cronet-httpcache"><br>以Android举例，如上图，Cronet是一个单线程网络库，在java层存在唯一的CronetEngine，在C++层存在唯一的URLRequestContext，它们是网络库最核心的上下文。<br><a id="more"></a></p>
<h3><span id="代码解析">代码解析</span></h3><p>我们重点关注一下httpCache是如何运作的<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// cronetEngine.java</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">Builder</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">    mContext = context;</div><div class="line">    setLibraryName(<span class="string">"cronet"</span>);</div><div class="line">    setApplicationName(<span class="string">""</span>);</div><div class="line">    enableLegacyMode(<span class="keyword">false</span>);</div><div class="line">    enableQUIC(<span class="keyword">false</span>);</div><div class="line">    enableHTTP2(<span class="keyword">true</span>);</div><div class="line">    enableSDCH(<span class="keyword">false</span>);</div><div class="line">    <span class="comment">//初始化的时候，默认关闭cache，第二个参数是cache的size，也默认是0</span></div><div class="line">    enableHttpCache(HTTP_CACHE_DISABLED, <span class="number">0</span>);</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="comment">/* 端上实际通过调用这个成员方法，开启httpcache，并传入cache的size */</span></div><div class="line"><span class="function"><span class="keyword">public</span> Builder <span class="title">enableHttpCache</span><span class="params">(@HttpCacheSetting <span class="keyword">int</span> cacheMode, <span class="keyword">long</span> maxSize)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (cacheMode == HTTP_CACHE_DISK || cacheMode == HTTP_CACHE_DISK_NO_HTTP) &#123;</div><div class="line">        <span class="keyword">if</span> (storagePath() == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Storage path must be set"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">if</span> (storagePath() != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Storage path must not be set"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    mDisableCache =</div><div class="line">            (cacheMode == HTTP_CACHE_DISABLED || cacheMode == HTTP_CACHE_DISK_NO_HTTP);</div><div class="line">    mHttpCacheMaxSize = maxSize;</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">    状态共用四种，分别表示关闭、disk模式(no http)、disk模式2、内存模式</span></div><div class="line"><span class="comment">*/</span></div><div class="line">    <span class="keyword">switch</span> (cacheMode) &#123;</div><div class="line">        <span class="keyword">case</span> HTTP_CACHE_DISABLED:</div><div class="line">            mHttpCacheMode = HttpCacheType.DISABLED;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> HTTP_CACHE_DISK_NO_HTTP:</div><div class="line">        <span class="keyword">case</span> HTTP_CACHE_DISK:</div><div class="line">            mHttpCacheMode = HttpCacheType.DISK;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> HTTP_CACHE_IN_MEMORY:</div><div class="line">            mHttpCacheMode = HttpCacheType.MEMORY;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Unknown cache mode"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>配置将会通过jni接口传递到C++层，会先初始化URLRequestContextConfig，传入必要配置，之后调用ConfigureURLRequestContextBuilder进行更精细的配置传递<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// URLRequestContextConfig.cc</span></div><div class="line"></div><div class="line"><span class="keyword">void</span> URLRequestContextConfig::ConfigureURLRequestContextBuilder(</div><div class="line">    net::URLRequestContextBuilder* context_builder,</div><div class="line">    net::NetLog* net_log) &#123;</div><div class="line">  <span class="built_in">std</span>::<span class="built_in">string</span> config_cache;</div><div class="line">  <span class="comment">/* 把httpcahce的配置传递给context_builder(在adapter持有) */</span></div><div class="line">  <span class="keyword">if</span> (http_cache != DISABLED) &#123;</div><div class="line">    net::URLRequestContextBuilder::HttpCacheParams cache_params;</div><div class="line">    <span class="keyword">if</span> (http_cache == DISK &amp;&amp; !storage_path.empty()) &#123;</div><div class="line">      cache_params.type = net::URLRequestContextBuilder::HttpCacheParams::DISK;</div><div class="line">      cache_params.path = base::FilePath(storage_path);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      cache_params.type =</div><div class="line">          net::URLRequestContextBuilder::HttpCacheParams::IN_MEMORY;</div><div class="line">    &#125;</div><div class="line">    cache_params.max_size = http_cache_max_size;</div><div class="line">    context_builder-&gt;EnableHttpCache(cache_params);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    context_builder-&gt;DisableHttpCache();</div><div class="line">  &#125;</div><div class="line">  context_builder-&gt;set_user_agent(user_agent);</div><div class="line">  context_builder-&gt;SetSpdyAndQuicEnabled(enable_spdy, enable_quic);</div><div class="line">  context_builder-&gt;set_sdch_enabled(enable_sdch);</div><div class="line">  <span class="keyword">if</span> (enable_quic)</div><div class="line">    context_builder-&gt;set_quic_user_agent_id(quic_user_agent_id);</div><div class="line">  ParseAndSetExperimentalOptions(experimental_options, context_builder,</div><div class="line">                                 net_log);</div><div class="line">  <span class="keyword">if</span> (mock_cert_verifier)</div><div class="line">    context_builder-&gt;SetCertVerifier(<span class="built_in">std</span>::move(mock_cert_verifier));</div><div class="line">  <span class="comment">// TODO(mef): Use |config| to set cookies.</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>把所有配置都消化好了之后，调用其build()方法，构建出url_request_context<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// url_request_context_builder.cc</span></div><div class="line">scoped_ptr&lt;URLRequestContext&gt; URLRequestContextBuilder::Build() &#123;</div><div class="line">   </div><div class="line">  <span class="comment">/* 省略部分代码 */</span></div><div class="line">  <span class="comment">/* 根据httpcache的配置，创建相应的http_transaction_factory</span></div><div class="line"><span class="comment">     如果打开了cache，则根据是disk还是memory，创建不同的backend（我理解就是cache存储结构的封装）</span></div><div class="line"><span class="comment">     并且，在创建transaction的时候，传入的是http_cache_transaction.</span></div><div class="line"><span class="comment">     如果关闭，则创建的http_network_transaction，纯走网络</span></div><div class="line"><span class="comment">  */</span></div><div class="line">  scoped_ptr&lt;HttpTransactionFactory&gt; http_transaction_factory;</div><div class="line">  <span class="keyword">if</span> (http_cache_enabled_) &#123;</div><div class="line">    scoped_ptr&lt;HttpCache::BackendFactory&gt; http_cache_backend;</div><div class="line">    <span class="keyword">if</span> (http_cache_params_.type != HttpCacheParams::IN_MEMORY) &#123;</div><div class="line">      BackendType backend_type =</div><div class="line">          http_cache_params_.type == HttpCacheParams::DISK</div><div class="line">              ? CACHE_BACKEND_DEFAULT</div><div class="line">              : CACHE_BACKEND_SIMPLE;</div><div class="line">      http_cache_backend.reset(<span class="keyword">new</span> HttpCache::DefaultBackend(</div><div class="line">          DISK_CACHE, backend_type, http_cache_params_.path,</div><div class="line">          http_cache_params_.max_size, context-&gt;GetFileTaskRunner()));</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      http_cache_backend =</div><div class="line">          HttpCache::DefaultBackend::InMemory(http_cache_params_.max_size);</div><div class="line">    &#125;</div><div class="line">    http_transaction_factory.reset(<span class="keyword">new</span> HttpCache(</div><div class="line">        storage-&gt;http_network_session(), <span class="built_in">std</span>::move(http_cache_backend), <span class="literal">true</span>));</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    http_transaction_factory.reset(</div><div class="line">        <span class="keyword">new</span> HttpNetworkLayer(storage-&gt;http_network_session()));</div><div class="line">  &#125;</div><div class="line">  storage-&gt;set_http_transaction_factory(<span class="built_in">std</span>::move(http_transaction_factory));</div><div class="line">  URLRequestJobFactoryImpl* job_factory = <span class="keyword">new</span> URLRequestJobFactoryImpl;</div><div class="line">  <span class="keyword">if</span> (data_enabled_)</div><div class="line">    job_factory-&gt;SetProtocolHandler(<span class="string">"data"</span>,</div><div class="line">                                    make_scoped_ptr(<span class="keyword">new</span> DataProtocolHandler));</div><div class="line">  <span class="comment">/* 省略部分代码 */</span></div><div class="line"> </div><div class="line">  <span class="keyword">return</span> <span class="built_in">std</span>::move(context);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3><span id="为什么post请求不支持httpcache">为什么POST请求不支持httpCache</span></h3><p>以上已经讲述了是否使用cache，在Cronet创建过程的异同点，最终使用httpCache，只是http_cache_transaction.cc 与 http_network_transaction.cc里面状态机的异同。</p>
<p>这里有个新问题可以一起探究一下，为啥Cronet的post请求不支持httpCache</p>
<p>首先我们看一下在http_cache_transaction中，已经有了针对post请求的单独处理逻辑。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// http_cache_transaction.cc</span></div><div class="line"><span class="comment">// 由 HttpCache::Transaction::DoGetBackendComplete调用</span></div><div class="line"><span class="comment">// 返回false代表走httpcache流程</span></div><div class="line"> </div><div class="line"><span class="keyword">bool</span> HttpCache::Transaction::ShouldPassThrough() &#123;</div><div class="line">  <span class="comment">// We may have a null disk_cache if there is an error we cannot recover from,</span></div><div class="line">  <span class="comment">// like not enough disk space, or sharing violations.</span></div><div class="line">  <span class="keyword">if</span> (!cache_-&gt;disk_cache_.get())</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">  <span class="keyword">if</span> (effective_load_flags_ &amp; LOAD_DISABLE_CACHE)</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">  <span class="keyword">if</span> (request_-&gt;method == <span class="string">"GET"</span> || request_-&gt;method == <span class="string">"HEAD"</span>)</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">  <span class="comment">// 如果方法为post，只有在upload_data_stream存在已经其identifier不为0的情况</span></div><div class="line">  <span class="keyword">if</span> (request_-&gt;method == <span class="string">"POST"</span> &amp;&amp; request_-&gt;upload_data_stream &amp;&amp;</div><div class="line">      request_-&gt;upload_data_stream-&gt;identifier()) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">if</span> (request_-&gt;method == <span class="string">"PUT"</span> &amp;&amp; request_-&gt;upload_data_stream)</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">  <span class="keyword">if</span> (request_-&gt;method == <span class="string">"DELETE"</span>)</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>那么代码里的upload_data_stream又是做啥的呢？<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// UploadDataStream的构造函数，也是identifier的唯一赋值入口。</span></div><div class="line">UploadDataStream::UploadDataStream(<span class="keyword">bool</span> is_chunked, <span class="keyword">int64_t</span> identifier)</div><div class="line">    : total_size_(<span class="number">0</span>),</div><div class="line">      current_position_(<span class="number">0</span>),</div><div class="line">      identifier_(identifier),</div><div class="line">      is_chunked_(is_chunked),</div><div class="line">      initialized_successfully_(<span class="literal">false</span>),</div><div class="line">      is_eof_(<span class="literal">false</span>) &#123;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> 用户层代码流程是，用户调用urlrequest的start:</span></div><div class="line"><span class="comment"> 实际调用了CronetUrlRequest::start-&gt;CronetUploadStream::attachNativeAdapterToRequest-&gt;jni-&gt;CronetUploadDataStream();</span></div><div class="line"><span class="comment">**/</span></div><div class="line"> </div><div class="line">CronetUploadDataStream::CronetUploadDataStream(Delegate* delegate, <span class="keyword">int64_t</span> size)</div><div class="line">    : UploadDataStream(size &lt; <span class="number">0</span>, <span class="number">0</span>), <span class="comment">//直接默认以0为identifier的初始值创建了upload_data_stream</span></div><div class="line">      size_(size),</div><div class="line">      waiting_on_read_(<span class="literal">false</span>),</div><div class="line">      read_in_progress_(<span class="literal">false</span>),</div><div class="line">      waiting_on_rewind_(<span class="literal">false</span>),</div><div class="line">      rewind_in_progress_(<span class="literal">false</span>),</div><div class="line">      at_front_of_stream_(<span class="literal">true</span>),</div><div class="line">      delegate_(delegate),</div><div class="line">      weak_factory_(<span class="keyword">this</span>) &#123;&#125;</div></pre></td></tr></table></figure></p>
<p>因此，cronet本身实际上把identifier关闭了（置0），使得所有依赖该值的功能都是失效的，包括post请求使用httpcache</p>
<h4><span id="佐证材料">佐证材料</span></h4><p>先找一个相关的资料</p>
<ul>
<li><p>http协议文档<br><img src="/blog/ef0c76f5/cronet-rfc.jpg" alt="RFC"><br>来自rfc7234:[<a href="https://www.rfc-editor.org/rfc/pdfrfc/rfc7234.txt.pdf" target="_blank" rel="external">https://www.rfc-editor.org/rfc/pdfrfc/rfc7234.txt.pdf</a>]</p>
</li>
<li><p>chromium-discuss资料<br><img src="/blog/ef0c76f5/cronet-chromium-discuss.jpg" alt="chromium-discuss"><br>[<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=513164" target="_blank" rel="external">https://bugs.chromium.org/p/chromium/issues/detail?id=513164</a>]</p>
</li>
</ul>
<p>由http协议对httpcache的介绍来看，协议层是没有对使用httpcache的方法类型做限制的。</p>
<p>chromium项目论坛中的一个issue，包括cronet作者mmenke rvargas的回应。<br>基本观点是cronet作者不认为缓存post请求是合理的。</p>
<h4><span id="结论">结论</span></h4><p>目前cronet中的httpcache是不支持post的，原因是原作者不认为这是一个合理的使用场景。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://kkrisen.top/blog/ef0c76f5/" data-id="cjbayxxj00002dt9kiht6xpbb" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/blog/67201122/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          在chromium项目中支持gcov单测覆盖率
        
      </div>
    </a>
  
  
    <a href="/blog/7f21d20d/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Cronet http-header相关逻辑梳理</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/fcf2134a/">移动端前后台状态通知机制实现</a>
          </li>
        
          <li>
            <a href="/blog/4ed07732/">C++静态库符号冲突解决方案</a>
          </li>
        
          <li>
            <a href="/blog/9ef298c6/">项目开源解决方案</a>
          </li>
        
          <li>
            <a href="/blog/2cad0b6d/">iOS webview 网络请求代理调研</a>
          </li>
        
          <li>
            <a href="/blog/d433ace1/">iOS版本导致NSURLSession表现不一致问题调研</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Krisen Tan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>